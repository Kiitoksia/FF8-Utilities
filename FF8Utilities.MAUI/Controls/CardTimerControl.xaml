<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" 
             xmlns:models="clr-namespace:FF8Utilities.MAUI.Models" 
             xmlns:skia="clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls" 
             xmlns:converters="clr-namespace:FF8Utilities.MAUI.Converters"
             x:DataType="models:CardManipulationModel"
             xmlns:buttons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="FF8Utilities.MAUI.Controls.CardTimerControl">
    <ContentView.Resources>
        <toolkit:IsStringNotNullOrWhiteSpaceConverter x:Key="StringIsNullConverter"/>
        <converters:BoolConverter x:TypeArguments="x:String" True="STOP" False="GO" x:Key="SubmitButtonLabelConverter"/>
        <converters:BoolConverter x:TypeArguments="Color" True="{StaticResource StandardGreeen}" False="{StaticResource StandardBlue}" x:Key="SubmitButtonBackgroundConverter"/>
    </ContentView.Resources>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition/>
            </Grid.RowDefinitions>

        <VerticalStackLayout>
            <Label Text="{Binding Explanation, Mode=OneWay}" HorizontalTextAlignment="Center"/>
            
            <Entry
            x:Name="RecoveryEntry"
            ClearButtonVisibility="WhileEditing"
            HorizontalOptions="Fill"
            Keyboard="Numeric"
            Placeholder="Enter cards for recovery or 1st try search"
                PlaceholderColor="Gray"
            Text="{Binding RecoveryPattern}"            
            ReturnCommand="{Binding SubmitCommand, Mode=OneTime}"
            TextColor="White" />
            <Label Text="{Binding FoundCards, Mode=OneWay}" IsVisible="{Binding FoundCards, Converter={StaticResource StringIsNullConverter}}" />
            <Label Text="{Binding ErrorText, Mode=OneWay}" IsVisible="{Binding ErrorText, Converter={StaticResource StringIsNullConverter}}"/>
        </VerticalStackLayout>



        <VerticalStackLayout Grid.Row="1" VerticalOptions="Fill">
            <skia:SKCanvasView PaintSurface="SKCanvasView_PaintSurface" HeightRequest="30" HorizontalOptions="Fill" x:Name="SnakeView"/>

            <Border BackgroundColor="{Binding InstantMashBackgroundMaui, Mode=OneWay}" IsVisible="{Binding ShowInstantMashText, Mode=OneWay}" Padding="5">
                <HorizontalStackLayout HorizontalOptions="Center">
                    <Label Text="Instant Mash:"/>
                    <Label Text="{Binding FirstFrameAvailableFramesDisplay, Mode=OneWay}" Margin="5,0"/>
                    <Label Text="{Binding InstantMashFramesAvailable, StringFormat='({0} frames)', Mode=OneWay}"/>
                </HorizontalStackLayout>
            </Border>
        </VerticalStackLayout>

        <buttons:SfButton Command="{Binding SubmitCommand, Mode=OneTime}" 
                          Text="{Binding IsTimerRunning, Converter={StaticResource SubmitButtonLabelConverter}}" 
                          Margin="5" 
                          VerticalOptions="Fill" 
                          Grid.Row="2" 
                          FontSize="Large" 
                          Style="{StaticResource BaseSfButton}" 
                          BackgroundColor="{Binding IsTimerRunning, Converter={StaticResource SubmitButtonBackgroundConverter}}"
                          Background="{Binding IsTimerRunning, Converter={StaticResource SubmitButtonBackgroundConverter}}"
                          />
    </Grid>
    
</ContentView>
