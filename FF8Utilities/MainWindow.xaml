<Controls:MetroWindow
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
        xmlns:local="clr-namespace:FF8Utilities"
    x:Class="FF8Utilities.MainWindow"
    xmlns:fa="http://schemas.fontawesome.io/icons/"
        xmlns:system="clr-namespace:System;assembly=mscorlib"
        xmlns:models="clr-namespace:FF8Utilities.Models"
        xmlns:extensions="clr-namespace:FF8Utilities.Extensions"
        xmlns:ff8Utilities="clr-namespace:FF8Utilities"
        xmlns:data="clr-namespace:FF8Utilities.Common;assembly=FF8Utilities.Common"
        xmlns:converters="clr-namespace:FF8Utilities.Converters"
        xmlns:controls="clr-namespace:FF8Utilities.Controls"
        xmlns:ultimeciamanip="clr-namespace:UltimeciaManip;assembly=UltimeciaManip"
        ShowMaxRestoreButton="False"
        x:Name="Window"
        mc:Ignorable="d"
        ResizeMode="CanResizeWithGrip"
        Title="{Binding Settings.PlatformDisplay, StringFormat='FF8 Utilities: {0}'}" Height="500" Width="700"
    GlowBrush="{DynamicResource AccentColorBrush}"
    WindowStartupLocation="CenterScreen"
    MinHeight="700"
    Topmost="False"
    ShowIconOnTitleBar="True"
    MinWidth="700">
    <Controls:MetroWindow.Resources>
        <Style TargetType="fa:FontAwesome">
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <DataTemplate x:Key="CharacterTemplate">
            <StackPanel HorizontalAlignment="Center" Margin="10,0,0,0">
                <Controls:Tile Visibility="{Binding IsFastest, Converter={x:Static converters:KiiVisibilityConverter.TrueToCollapsed}}" Title="{Binding Display}" Height="100" Width="200" Count="{Binding Count}" VerticalTitleAlignment="Top"/>
                <Controls:Tile Visibility="{Binding IsFastest, Converter={x:Static converters:KiiVisibilityConverter.FalseToCollapsed}}" Title="{Binding Display}" Height="100" Width="200" Count="{Binding Count}" VerticalTitleAlignment="Top" Background="#CC06761F"/>
            </StackPanel>
        </DataTemplate>
        <DataTemplate x:Key="LineupTemplate">
            <GroupBox Margin="2" Header="{Binding Movements}">
                <StackPanel>
                    <ItemsControl ItemsSource="{Binding LineupsLineOne}" ItemTemplate="{StaticResource CharacterTemplate}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                    <ItemsControl ItemsSource="{Binding LineupsLineTwo}" ItemTemplate="{StaticResource CharacterTemplate}" Visibility="{Binding LineupTwoVisible, Converter={x:Static converters:KiiVisibilityConverter.FalseToCollapsed}}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                    <ItemsControl ItemsSource="{Binding LineupsLineThree}" ItemTemplate="{StaticResource CharacterTemplate}" Visibility="{Binding LineupThreeVisible, Converter={x:Static converters:KiiVisibilityConverter.FalseToCollapsed}}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                </StackPanel>
            </GroupBox>
        </DataTemplate>
    </Controls:MetroWindow.Resources>
    <Controls:MetroWindow.DataContext>
        <models:MainModel Window="{x:Reference Window}" 
                          UltimeciaTextBox="{x:Reference UltimeciaInputBox}"/>
    </Controls:MetroWindow.DataContext>
    <Controls:MetroWindow.RightWindowCommands>
        <Controls:WindowCommands>
            <Button Command="{Binding Settings.UpdateCSRCommand}" Controls:VisibilityHelper.IsVisible="{Binding CSRUpdateAvailable}">
                <StackPanel Orientation="Horizontal">
                    <fa:ImageAwesome Icon="Download" Height="10" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,0,10,0"/>
                    <TextBlock Text="CSR Update Available" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                </StackPanel>
            </Button>
            <TextBlock Text="{Binding Version}" VerticalAlignment="Center" HorizontalAlignment="Center" Opacity="0.45" Margin="10,0,10,0"/>
            <Button Command="{Binding UpdateAvailableCommand}" Controls:VisibilityHelper.IsVisible="{Binding UpdateAvailable}">
                <StackPanel Orientation="Horizontal">
                    <fa:ImageAwesome Icon="Download" Height="10" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,0,10,0"/>
                    <TextBlock Text="Update Available" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                </StackPanel>
            </Button>
            <Button Command="{Binding ShowAboutCommand}">
                <StackPanel Orientation="Horizontal">
                    <fa:ImageAwesome Icon="Info" Height="10" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,0,10,0" Foreground="White"/>
                    <TextBlock Text="About" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                </StackPanel>
            </Button>
            <Button Command="{Binding ShowSettingsCommand}">
                <StackPanel Orientation="Horizontal">
                    <fa:ImageAwesome Icon="Cog" Height="10" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,0,10,0" />
                    <TextBlock Text="Settings" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                </StackPanel>
            </Button>
        </Controls:WindowCommands>
    </Controls:MetroWindow.RightWindowCommands>
    <StackPanel>
        <Controls:MetroAnimatedTabControl            
            Controls:TabControlHelper.Underlined="SelectedTabItem">
            <Controls:MetroAnimatedTabControl.Resources>
                <Style TargetType="{x:Type TabPanel}">
                    <Setter Property="HorizontalAlignment" Value="Center"/>
                </Style>
            </Controls:MetroAnimatedTabControl.Resources>
            <TabItem Header="Zell Card">
                <Grid Margin="0,20,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition/>
                        <RowDefinition/>
                        <RowDefinition/>
                        <RowDefinition/>
                        <RowDefinition/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition  Width="0.4*"/>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="0.15*"/>
                    </Grid.ColumnDefinitions>

                    <GroupBox Grid.ColumnSpan="3" Margin="20,20,20,0" Header="(Quistis Card) Cards to select">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <TextBlock FontSize="14" Text="Early Quistis" FontWeight="Bold"/>
                            <TextBlock FontSize="14" Text="Late Quistis" FontWeight="Bold" Grid.Row="1"/>
                            <TextBlock FontSize="14" Text="Geezard, Funguar, Gayla, Fastitocalon-F, Caterchipallar" Grid.Column="1"/>
                            <TextBlock FontSize="14" Text="Funguar, Red Bat, Fastitocalon-F, Caterchipallar, Ifrit" Grid.Row="1" Grid.Column="1"/>
                        </Grid>

                    </GroupBox>
                    <TextBlock Grid.Row="1" Text="Quistis Pattern" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="18"/>
                    <Grid Grid.Row="1" Grid.Column="1" Margin="20,20,0,20">
                        <ComboBox 
                                    ItemsSource="{Binding Source={x:Static data:EarlyQuistisPattern.Options}}"  
                                    SelectedItem="{Binding Pattern}"
                                    DisplayMemberPath="Description"
                                    HorizontalAlignment="Stretch"
                                    />
                    </Grid>

                    <ToggleButton Grid.Row="1" Margin="0,20,20,20" Grid.Column="2" IsChecked="{Binding ShowNotes}" Controls:VisibilityHelper.IsHidden="{Binding UseCustomQuistisPattern}">
                        <fa:ImageAwesome Icon="ListOl" Margin="5" Height="15" Foreground="White"/>
                    </ToggleButton>
                    <StackPanel Grid.Row="3" Grid.Column="0" VerticalAlignment="Center" Margin="0,12">
                        <TextBlock Text="RNG Modifier" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="18"/>
                        <TextBlock Text="(Optional)" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="14"/>
                    </StackPanel>
                    <GroupBox Header="Card Order" Margin="20,0,0,20" BorderThickness="3" Visibility="{Binding ShowNotes, Converter={x:Static converters:KiiVisibilityConverter.FalseToCollapsed}}" Grid.Row="2" Grid.Column="1">
                        <ItemsControl ItemsSource="{Binding CardNotes}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="0.05*"/>
                                            <ColumnDefinition Width="0.2*"/>
                                            <ColumnDefinition Width="0.6*"/>
                                        </Grid.ColumnDefinitions>
                                        <fa:ImageAwesome  Height="10" Icon="CaretSquareOutlineRight"  Margin="5" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="#FFB5B5B5"  />
                                        <TextBlock Grid.Column="1" Text="{Binding Card}" Foreground="#bd43d1" FontWeight="Bold" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding Position}" Grid.Column="2" VerticalAlignment="Center"/>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </GroupBox>
                    <TextBox Text="{Binding RngPattern, TargetNullValue=''}" Grid.Row="3" Grid.Column="1" Margin="20,20,0,20"/>
                    <Button Grid.Row="3" Grid.Column="2" Margin="0,20,20,20" Command="{Binding LaunchZellCalculatorCommand}">
                        <fa:ImageAwesome Icon="Calculator" Height="15" Margin="5" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" />
                    </Button>

                    <Button Style="{StaticResource MahApps.Styles.Button.Square}" Width="150" Height="50" Grid.Row="4" Grid.Column="0"  Command="{Binding ZellCountdownCommand}">
                        <StackPanel Orientation="Horizontal" Height="20">
                            <fa:ImageAwesome Icon="ClockOutline" Margin="5" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" />
                            <TextBlock Text="{Binding ZellCountdownText}" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button Style="{StaticResource MahApps.Styles.Button.Square.Accent}" Width="200" Height="50" Grid.Row="4" Grid.Column="1" Grid.ColumnSpan="2" Command="{Binding ZellLaunchCommand}" Margin="38,0,221,0"                                >
                        <StackPanel Orientation="Horizontal" Height="20">
                            <fa:ImageAwesome Icon="Check" Margin="5" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            <TextBlock Text="Submit" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <GroupBox Grid.ColumnSpan="3" Grid.Row="5" Margin="20,20,20,0" Header="(Zell Card) Cards to select">
                        <TextBlock FontSize="14" Text="Geezard, Red Bat, Gayla, Quistis, Ifrit"/>
                    </GroupBox>
                </Grid>
            </TabItem>
            <TabItem Header="Fish Fins" Controls:VisibilityHelper.IsVisible="{Binding FishFinManipEnabled}">
                <DockPanel LastChildFill="True" Margin="10">
                    <GroupBox Header="Filter" DockPanel.Dock="Top" x:Name="FilterGroup">
                        <StackPanel>
                            <DockPanel>
                                <TextBlock Text="Battle Start" VerticalAlignment="Center" HorizontalAlignment="Stretch"/>
                                <Button Style="{StaticResource MahApps.Styles.Button.Dialogs.Accent}" Content="Standard" x:Name="ButtonStandard" Margin="10,0,0,0" Click="ButtonStandard_Click" Width="100"/>
                                <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}" Content="Back Attack" x:Name="ButtonBackAttack" Margin="10,0,0,0" Click="ButtonBackAttack_Click" Width="100" />
                                <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}" Content="Struck First" x:Name="ButtonStruckFirst" Margin="10,0,0,0" Click="ButtonStruckFirst_Click" Width="100"/>
                                <Button Content="Reset" HorizontalContentAlignment="Right" HorizontalAlignment="Right" x:Name="Reset" Click="Reset_Click"/>
                            </DockPanel>
                            <Grid Margin="0, 10,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                </Grid.ColumnDefinitions>
                                <GroupBox BorderThickness="1,0,0,1" Header="First Attack">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition/>
                                            <ColumnDefinition/>
                                        </Grid.ColumnDefinitions>
                                        <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}" BorderThickness="1" x:Name="FirstSquallButton" Content="Squall" HorizontalAlignment="Stretch" Margin="2" />
                                        <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}"  BorderThickness="1" x:Name="FirstSquallCrossButton" Content="Squall (Cross)"  Grid.Column="1" HorizontalAlignment="Stretch" Margin="2" />
                                        <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}"  BorderThickness="1" x:Name="FirstQuistisButton" Content="Quistis"  Grid.Row="1" HorizontalAlignment="Stretch" Margin="2"/>
                                        <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}"  BorderThickness="1" x:Name="FirstQuistisCrossButton" Content="Quistis (Cross)" Grid.Row="1" Grid.Column="1" HorizontalAlignment="Stretch" Margin="2"/>
                                        <Controls:NumericUpDown Grid.Row="2" Grid.ColumnSpan="2" x:Name="FirstDamageRoll" Minimum="0" Maximum="99"/>
                                    </Grid>
                                </GroupBox>
                                <GroupBox BorderThickness="1" Header="Second Attack" Grid.Column="1">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition/>
                                            <ColumnDefinition/>
                                        </Grid.ColumnDefinitions>
                                        <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}" BorderThickness="1" x:Name="SecondSquallButton" Content="Squall" HorizontalAlignment="Stretch" Margin="2" />
                                        <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}" BorderThickness="1" x:Name="SecondSquallCrossButton" Content="Squall (Cross)"  Grid.Column="1" HorizontalAlignment="Stretch" Margin="2" />
                                        <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}" BorderThickness="1" x:Name="SecondQuistisButton" Content="Quistis"  Grid.Row="1" HorizontalAlignment="Stretch" Margin="2"/>
                                        <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}" BorderThickness="1" x:Name="SecondQuistisCrossButton" Content="Quistis (Cross)" Grid.Row="1" Grid.Column="1" HorizontalAlignment="Stretch" Margin="2"/>
                                        <Controls:NumericUpDown Grid.Row="2" Grid.ColumnSpan="2" x:Name="SecondDamageRoll"  Minimum="0" Maximum="99"/>
                                    </Grid>
                                </GroupBox>
                                <GroupBox BorderThickness="0,0,1,1" Header="Third Attack" Grid.Column="2">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                            <RowDefinition/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition/>
                                            <ColumnDefinition/>
                                        </Grid.ColumnDefinitions>
                                        <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}" BorderThickness="1" x:Name="ThirdSquallButton" Content="Squall" HorizontalAlignment="Stretch" Margin="2" />
                                        <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}" BorderThickness="1" x:Name="ThirdSquallCrossButton" Content="Squall (Cross)"  Grid.Column="1" HorizontalAlignment="Stretch" Margin="2" />
                                        <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}" BorderThickness="1" x:Name="ThirdQuistisButton" Content="Quistis"  Grid.Row="1" HorizontalAlignment="Stretch" Margin="2"/>
                                        <Button Style="{StaticResource MahApps.Styles.Button.MetroSquare}" BorderThickness="1" x:Name="ThirdQuistisCrossButton" Content="Quistis (Cross)" Grid.Row="1" Grid.Column="1" HorizontalAlignment="Stretch" Margin="2"/>
                                        <Controls:NumericUpDown Grid.Row="2" Grid.ColumnSpan="2" x:Name="ThirdDamageRoll" Minimum="0" Maximum="99"/>
                                    </Grid>
                                </GroupBox>
                            </Grid>

                        </StackPanel>
                    </GroupBox>
                    <GroupBox Header="Pattern" DockPanel.Dock="Top" Margin="0,10,0,10" Height="60">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="30"/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <Button x:Name="UnlockManualEntryBox" Click="UnlockManualEntryBox_Click" Width="30">
                                <fa:ImageAwesome x:Name="LockIcon" Icon="Unlock" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" />
                            </Button>
                            <TextBox x:Name="FishFinTextBox"
                                      Grid.Column="1"
                                     IsEnabled="False"
                                     Text="{Binding FishFinManipPattern, TargetNullValue={x:Static system:String.Empty}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" HorizontalContentAlignment="Stretch" HorizontalAlignment="Stretch"/>
                        </Grid>
                    </GroupBox>
                    <GroupBox Header="Results" MinHeight="300">
                        <Grid>
                            <DataGrid ItemsSource="{Binding FishPatterns}" 
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  CanUserReorderColumns="False"                                  
                                  CanUserResizeRows="False"      
                                  IsReadOnly="True"          
                                  IsHitTestVisible="False"
                                  AutoGenerateColumns="False"
                                  VerticalScrollBarVisibility="Auto"
                                  RowHeight="100"
                                  CanUserSortColumns="False">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Binding="{Binding Index}" Header="Index" Width="60">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Binding="{Binding Pattern}" Header="Pattern" Width="120">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Binding="{Binding ATBRefreshes}" Header="ATB Refreshes" Width="120" FontWeight="Bold">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Binding="{Binding DropCount}" Header="Drops" Width="80">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTemplateColumn Header="Notes" Width="*">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Margin="5,0,5,0">
                                                    <Border Visibility="{Binding GeneralCommentsVisible, Converter={x:Static converters:KiiVisibilityConverter.FalseToCollapsed}}" Margin="0,0,0,5" CornerRadius="5" Background="Brown" Padding="5" Width="Auto">
                                                        <TextBlock Text="{Binding GeneralComment}" Foreground="White"/>
                                                    </Border>
                                                    <Border Visibility="{Binding Phase1CommentsVisible, Converter={x:Static converters:KiiVisibilityConverter.FalseToCollapsed}}" Margin="0,0,0,5" CornerRadius="5" Background="Green" Padding="5">
                                                        <TextBlock Text="{Binding Phase1Comment}" Foreground="White"/>
                                                    </Border>
                                                    <Border Visibility="{Binding Phase2CommentsVisible, Converter={x:Static converters:KiiVisibilityConverter.FalseToCollapsed}}" Margin="0,0,0,5" CornerRadius="5" Background="Blue" Padding="5" Width="Auto">
                                                        <TextBlock Text="{Binding Phase2Comment}" Foreground="White"/>
                                                    </Border>
                                                    <Border Visibility="{Binding Phase3CommentsVisible, Converter={x:Static converters:KiiVisibilityConverter.FalseToCollapsed}}" Margin="0,0,0,5" CornerRadius="5" Background="DarkOrange" Padding="5" Width="Auto">
                                                        <TextBlock Text="{Binding Phase3Comment}"/>
                                                    </Border>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>

                            <Controls:ProgressRing Controls:VisibilityHelper.IsVisible="{Binding FishPatternsPopulating}"/>
                        </Grid>
                    </GroupBox>
                </DockPanel>
            </TabItem>
            <TabItem Header="Caraway Code">
                <Grid Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="0.5*"/>
                        <ColumnDefinition Width="0.5*"/>
                    </Grid.ColumnDefinitions>
                    <GroupBox Header="Input" Width="300" Height="610" VerticalAlignment="Top" Margin="0,0,10,0">
                        <StackPanel>
                            <TextBlock Margin="5" HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center">
                                Only input complete sequences
                                <LineBreak/>
                                Subscripts are listed in most likely order
                            </TextBlock>
                            <ItemsControl ItemsSource="{Binding Poles}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel>
                                            <Grid Height="40">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="0.6*"/>
                                                    <ColumnDefinition Width="0.4*"/>
                                                    <ColumnDefinition Width="0.15*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Description}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                <Controls:NumericUpDown Minimum="-1" ValueChanged="NumericUpDown_ValueChanged" Maximum="16" Grid.Column="1" Value="{Binding Count, UpdateSourceTrigger=PropertyChanged}"/>
                                                <Button Grid.Column="2" Command="{Binding ClearCount}">
                                                    <StackPanel Orientation="Horizontal" Height="20">
                                                        <fa:ImageAwesome Icon="Remove" Margin="5" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" />
                                                    </StackPanel>
                                                </Button>
                                            </Grid>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Button Style="{StaticResource MahApps.Styles.Button.Square.Accent}" Command="{Binding SubmitPolesCommand}" Margin="0,20,0,0">
                                <StackPanel Orientation="Horizontal" Height="20">
                                    <fa:ImageAwesome Icon="Check" Margin="5" HorizontalAlignment="Center" VerticalAlignment="Center"  />
                                    <TextBlock Text="Submit" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                            <Button Style="{DynamicResource MahApps.Styles.Button.Square}" Command="{Binding ResetPolesCommand}" Margin="0,5,0,0">
                                <StackPanel Orientation="Horizontal" Height="20">
                                    <fa:ImageAwesome Icon="Remove" Margin="5" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White" />
                                    <TextBlock Text="Reset" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                            <Button Style="{DynamicResource MahApps.Styles.Button.Square}" Command="{Binding PoleTallyCommand}" Margin="0,5,0,0">
                                <StackPanel Orientation="Horizontal" Height="20">
                                    <fa:ImageAwesome Icon="ClockOutline" Margin="5" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White"/>
                                    <TextBlock Text="Tally" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <StackPanel Orientation="Horizontal" Margin="5" Height="30">
                                <TextBlock Text="Hide Unlikely Results"  VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <Controls:ToggleSwitch IsOn="{Binding HideUnlikelyCarawayResults}" OnContent="Yes" OffContent="No"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="5" Height="30">
                                <TextBlock Text="Show NPC Movement" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <Controls:ToggleSwitch IsOn="{Binding ShowCarawayNPCMovement}" OnContent="Yes" OffContent="No"/>
                            </StackPanel>

                            <GroupBox Header="Legend" Margin="0,5,0,0" BorderThickness="0,0,0,0">
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal">
                                        <Border Background="SaddleBrown" Width="20" Height="20" Margin="0, 5,5, 2"/>
                                        <TextBlock Text="CSR Only (Or you recently hard reset)" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal">
                                        <Border Background="{DynamicResource MahApps.Brushes.Accent}" Width="20" Height="20"  Margin="0, 5,5, 2"/>
                                        <TextBlock Text="Regular" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </StackPanel>

                            </GroupBox>
                        </StackPanel>
                    </GroupBox>
                    <StackPanel Height="610" Margin="0,0,10,0" Grid.Column="1">
                        <GroupBox Header="No Subscripts Found" Visibility="{Binding NoSubscriptsDetected, Converter={x:Static converters:KiiVisibilityConverter.FalseToCollapsed}}">
                            <TextBlock Text="No results found for input poles."/>
                        </GroupBox>
                        <ScrollViewer Height="610">
                            <ItemsControl ItemsSource="{Binding CarawayOutput}" >
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <GroupBox Header="{Binding SubscriptDisplay}" Margin="0,0,0,5">
                                            <GroupBox.Style>
                                                <Style TargetType="GroupBox" BasedOn="{StaticResource {x:Type GroupBox}}">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding LikelyCSR}" Value="true">
                                                            <Setter Property="Controls:HeaderedControlHelper.HeaderBackground" Value="SaddleBrown"/>
                                                            <Setter Property="BorderBrush" Value="SaddleBrown"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </GroupBox.Style>
                                            <StackPanel>
                                                <TextBlock Text="Last Series Complete" FontSize="16" HorizontalAlignment="Center"/>
                                                <Border Background="#FF798299" CornerRadius="5"/>
                                                <controls:CarawayOptionControl DataContext="{Binding CompleteOption}"/>
                                                <TextBlock Text="Last Series Incomplete" FontSize="16" HorizontalAlignment="Center" Margin="0,20,0,0"/>
                                                <Border Background="#FF798299" CornerRadius="5"/>
                                                <controls:CarawayOptionControl Grid.Row="3" Grid.Column="1" DataContext="{Binding IncompleteOption}"/>
                                            </StackPanel>
                                        </GroupBox>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                    </StackPanel>
                </Grid>
            </TabItem>
            <TabItem Header="Ultimecia">
                <DockPanel LastChildFill="True" MaxHeight="620">
                    <TextBlock DockPanel.Dock="Top" Text="Click in the inputs box to focus, then use WASD/Numpad(2,4,6,8) to input directions" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,20,0,0"/>
                    <GroupBox DockPanel.Dock="Top" Margin="20" Header="Inputs">
                        <StackPanel>
                            <TextBox x:Name="UltimeciaInputBox" Text="{Binding UltimeciaRng, TargetNullValue={x:Static system:String.Empty}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
Controls:TextBoxHelper.Watermark="Accepts 8462, WASD, any other character is a wildcard" DockPanel.Dock="Left"/>

                            <Grid Margin="0,10,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <TextBlock Text="Language" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5,10,10,10"/>
                                <ComboBox 
                                    Grid.Column="1"
                                    ItemsSource="{Binding Source={extensions:Enum {x:Type ultimeciamanip:UltimeciaManipLanguage}}}"  
                                    SelectedValue="{Binding UltimeciaManipLanguage}"
                                    DisplayMemberPath="Description"
                                    HorizontalAlignment="Left"
                                    Width="100"
                                    SelectedValuePath="Value"/>
                                <TextBlock Text="Include Rinoa Parties" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5, 0, 10, 0" Grid.Column="2"/>
                                <Controls:ToggleSwitch IsOn="{Binding IncludeRinoaParties}" OnContent="Yes" OffContent="No" Grid.Column="3"/>
                            </Grid>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="10">
                                <Button Style="{StaticResource MahApps.Styles.Button.Square.Accent}" Width="200" Height="50" Command="{Binding UltimeciaLaunchCommand}" Margin="0"                                >
                                    <StackPanel Orientation="Horizontal" Height="20">
                                        <fa:ImageAwesome Icon="Check" Margin="5" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                        <TextBlock Text="Submit" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Controls:MetroProgressBar Width="200" Value="{Binding UltimeciaTimer.Progress}" Visibility="Collapsed"/>
                            </StackPanel>

                        </StackPanel>
                    </GroupBox>
                    <GroupBox DockPanel.Dock="Top" Margin="20" Visibility="{Binding NoFormationsFound, Converter={x:Static converters:KiiVisibilityConverter.FalseToCollapsed}}"
                              Header="No formations found">
                        <TextBlock Text="No formations found for inputs, double check directions and re-submit"/>
                    </GroupBox>
                    <ItemsControl ItemsSource="{Binding UltimeciaFormations}" ItemTemplate="{StaticResource LineupTemplate}" DockPanel.Dock="Bottom" VerticalAlignment="Stretch">
                        <ItemsControl.Template>
                            <ControlTemplate>
                                <ScrollViewer>
                                    <ItemsPresenter/>
                                </ScrollViewer>
                            </ControlTemplate>
                        </ItemsControl.Template>
                    </ItemsControl>
                </DockPanel>
            </TabItem>
        </Controls:MetroAnimatedTabControl>
    </StackPanel>
</Controls:MetroWindow>
